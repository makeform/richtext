<div><style type="text/css">.variant{display:none}.has-variant .variant{display:inline}.ql-snow svg{vertical-align:initial}.ql-container{font-size:1em;word-break:break-all}.ql-container em{font-style:italic;font-weight:inherit}.ql-container strong{font-weight:bold}.ql-container img{max-width:100%}.ql-tool{position:sticky;top:0;background:#fff;z-index:1}.ql-editor{min-height:10em}</style><script type="@plotdb/block">var quillCss,wordLen,mod;quillCss={};wordLen=function(e,t){e==null&&(e="");return t==="simple-word"?e.split(/\s|[,.;:!?，。；：︰！？、．　"]/).filter(function(e){return e}).map(function(e){return e.split(/[\u1000-\uffff]/).map(function(e){if(e.length){return 2}else{return 1}}).reduce(function(e,t){return e+t},0)-1}).reduce(function(e,t){return e+t},0):e.length};module.exports={pkg:{name:"@makeform/richtext",extend:{name:"@makeform/common"},i18n:{en:{},"zh-TW":{}},dependencies:[{url:"https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.js"},{name:"ldcolor",version:"main",path:"index.min.js",async:false},{name:"@loadingio/ldcolorpicker",version:"main",path:"index.min.js"},{name:"@loadingio/ldcolorpicker",version:"main",path:"index.min.css",global:true},{name:"ldfile"}]},init:function(e){return e.pubsub.fire("subinit",{mod:mod(e)})}};mod=function(e){var i,t,n,r,o,a,g,h,p,v;i=e.root,t=e.ctx,n=e.data,r=e.parent,o=e.t;a=t.ldview,g=t.Quill,h=t.ldcolor,p=t.ldcolorpicker,v=t.ldfile;return{init:function(){var e,l,t,u,s,c,f,m,n,d=this;if(!quillCss.node){quillCss.node=e=document.createElement("link");e.setAttribute("rel","stylesheet");e.setAttribute("href","https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.snow.css");e.setAttribute("type","text/css");e.setAttribute("id","_quilljs-css-element");document.body.appendChild(e)}l=this.mod.child;this.on("change",function(e){var t;e==null&&(e={});t=s.getContents();if(JSON.stringify(t)===JSON.stringify(e.json||{})){return}return s.setContents(e.json||{})});l.view=t=new a({root:i,handler:{content:function(e){var t;t=e.node;return t.innerHTML=s.root.innerHTML}}});u=function(){};s=new g(t.get("input"),{theme:"snow",modules:{toolbar:{container:[[{header:[1,2,false]}],["bold","italic","underline"],[{list:"ordered"},{list:"bullet"},{align:[]}],["link","image"]],handlers:{image:function(){var o;o=document.createElement("input");o.setAttribute("type","file");o.setAttribute("accept","image/png, image/gif, image/jpeg");o.onchange=function(){var e,t,n,i,r;e={};t=o.files;if(!(t&&t.length)){return}t=[t[0]];o.value=null;n=m.key();i="data:image/svg+xml;base64,"+btoa('<svg data-key="'+n+'" '+m.loader);r=m.getSig(i);m.sig[r]=true;s.insertEmbed(s.getSelection().index,"image",i);return c(t.map(function(e){return{blob:e,sig:r}}),m.insert)};return o.click()}}}}});c=function(e,i){var r,o;e==null&&(e=[]);r={};o=function(t){var n;t==null&&(t=0);n=e[t];if(!n){return Promise.resolve()}return d.mod.child._upload({file:n.blob,progress:u}).then(function(e){var t;e=[(t=import$({},e),t.blob=n.blob,t)];if(r.detail){return r.detail(e)}else{return Promise.resolve(e)}}).then(function(e){e=e[0];delete e.blob;if(!l.file){l.file=[]}else if(!Array.isArray(l.file)){l.file=[l.file]}l.file.push(e);if(i){i((n.file=e,n))}return o(t+1)})};return o(0)};f=function(e){var t;t=e.map(function(t){return v.fromURL(t.image,"blob").then(function(e){return{blob:e.file,sig:t.sig}})});return Promise.all(t)};m={insert:function(t){var e,n,i;e=s.getContents();e.ops.filter(function(e){return t.sig===m.getSig((e.insert||{}).image)}).map(function(e){return e.insert.image=t.file.url});s.setContents(e,"silent");n=s.getText();i=s.root.innerHTML;return d.value({json:e,text:n,html:i})},hash:{},sig:{},needUpload:function(e){e==null&&(e="");return!!(/data:image/.exec(e)&&!m.sig[m.getSig(e)])},getSig:function(e){return(e||"").substring(0,64)},key:function(){return Date.now()+"-"+Math.random().toString(36).substring(2)},loader:'xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" width="96" height="96" style="background:#fafafa"><g><circle stroke-dasharray="131.95 45.98" r="28" stroke-width="8" stroke="#d7d7d7" fill="none" cy="50" cx="50"><animateTransform keyTimes="0;1" values="0 50 50;360 50 50" dur="1s" repeatCount="indefinite" type="rotate" attributeName="transform"></animateTransform></circle></g></svg>'};s.on("text-change",function(e,t,n){var i,r,o,l,u,a;i=s.getText();r=s.getContents();o=s.root.innerHTML;d.value({json:r,text:i,html:o});l={};u=e.ops.filter(function(e){return m.needUpload((e.insert||{}).image)}).map(function(e){var t,n,i,r;t=m.key();n=e.insert.image;i="data:image/svg+xml;base64,"+btoa('<svg data-key="'+t+'" '+m.loader);r=m.getSig(i);m.sig[r]=true;return l[n]={sig:r,image:n,placeholder:i}});if(!u.length){return}a=s.getContents();a.ops.map(function(e){var t;if(t=l[(e.insert||{}).image]){return e.insert.image=t.placeholder}});return debounce(0).then(function(){s.setContents(a,"silent");return f(u).then(function(e){return c(e,m.insert)}).then(function(){var e,t,n;e=s.getContents();t=s.getText();n=s.root.innerHTML;return d.value({json:e,text:t,html:n})})})});n=i.querySelector(".ql-color");l.ldcp=new p(n,{className:"round shadow-sm round flat compact-palette no-empty-color vertical",palette:["#ff0a0a","#ff7d0a","#ffdb06","#0a9f74","#0067ad","#6e20bd","#222","#eee"],idx:0,context:"richtext",exclusive:true});return l.ldcp.on("change",function(e){if(s.getSelection()){return s.format("color",h.web(e))}})},render:function(){if(this.mod.child.view){return this.mod.child.view.render()}},isEmpty:function(e){e=this.content(e);return typeof e==="undefined"||e===null||!e.text},isEqual:function(e,t){var n,i;n=this.isEmpty(e);i=this.isEmpty(t);if(!n!==!i&&(n||i)){return false}if(n&&i){return true}return JSON.stringify(e)===JSON.stringify(t)},content:function(e){return e||{json:{},text:""}},adapt:function(e){this.mod.child._upload=e.upload;return this.render()},opsets:[{id:"richtext",i18n:{},convert:function(e){return e},ops:{"image-count":{func:function(e,t){var n;t==null&&(t={});n=((e.json||{}).ops||[]).filter(function(e){return e.insert&&e.insert.image});if(t.min!=null){if(n.length<t.min){return false}}if(t.max!=null){if(n.length>t.max){return false}}return true},config:{min:{type:"number",hint:"minimal image count"},max:{type:"number",hint:"maximal image count"}}},"text-length":{func:function(e,t){var n,i;t==null&&(t={});n=(e.text||"").trim();i=wordLen(n,t.method);if(t.min!=null){if(i<t.min){return false}}if(t.max!=null){if(i>t.max){return false}}return true},config:{min:{type:"number",hint:"minimal char count"},max:{type:"number",hint:"maximal char count"},method:{type:"choice",default:"char",values:["char","simple-word"]}}}}}]}};function import$(e,t){var n={}.hasOwnProperty;for(var i in t)if(n.call(t,i))e[i]=t[i];return e}</script><div class="form-group has-tips manual" ld="base error-root" plug="widget"><div ld="display" data-display="block"><label class="d-flex align-items-end flex-wrap"><div><span ld="label"></span><span class="variant text-sm ml-2">(<span ld="variant"></span>)</span><span class="text-danger ml-2" ld="is-required">*</span></div><div class="flex-grow-1"></div><div class="m-edit"><div class="mf-note text-sm" ld="limitation"></div></div></label></div><div class="text-sm text-muted" ld="display" data-display="block"><div ld="desc" style="margin:-.6em 0 .7em"></div></div><div class="m-edit position-relative"><div ld="input"></div><div class="d-flex"><div class="p-1 text-danger rounded" ld-each="error"></div></div></div><div class="m-edit" ld="display" data-display="block"><div class="mf-note text-sm mt-2 note" ld-each="note"></div></div><div class="m-view position-relative ql-container ql-snow"><div class="border rounded-sm p-2 ql-editor" ld="content"></div></div></div></div>